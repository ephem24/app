{
  "name": "Next.js & Python Full-Stack Codespace",
  "image": "mcr.microsoft.com/devcontainers/universal:latest",
  
  // Make the GitHub token available in the container environment
  "containerEnv": {
    "GITHUB_TOKEN": "${localEnv:GITHUB_TOKEN}"
  },

  // Use postCreateCommand for earlier setup: install dependencies and fetch submodules
  "postCreateCommand": "npm install && git submodule init && git submodule update", 
  
  "forwardPorts": [3000, 5000, 5050, 6380], 
  "portsAttributes": {
    "3000": { "label": "Next.js Frontend", "onAutoForward": "openBrowser" },
    "5000": { "label": "Primary Python API" },
    "5050": { "label": "Secondary Python Service" },
    "6380": { "label": "Redis Cache (Custom Port)", "onAutoForward": "notify" }
  }, 
  
  "customizations": {
    "vscode": {
      "settings": {
        // Crucial setting to ensure Git uses the credential manager (GitHub token)
        "git.credentialHelper": "manager" 
      }
    },
    "codespaces": {
      "repositories": {
        "ephem24/ai-tutor-module": {
          "permissions": {
            "contents": "write" 
          }
        },
        "ephem24/app-prototype": {
          "permissions": {
            "contents": "write"
          }
        }
      }
    }
  }
}
