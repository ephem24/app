{
  "name": "Next.js & Python Full-Stack Codespace",
  "image": "mcr.microsoft.com/devcontainers/universal:latest",
  
  // Explicitly make the Codespace token available as a standard environment variable
  "containerEnv": {
    "GITHUB_TOKEN": "${localEnv:GITHUB_TOKEN}"
  },

  // 1. Run npm install
  // 2. Initialize submodules (which sets up .git/config)
  // 3. Update/pull the contents of the submodules using the new token
  "postStartCommand": "npm install && git submodule init && git submodule update",
  
  "forwardPorts": [3000, 5000, 5050, 6380], 
  "portsAttributes": {
    "3000": { "label": "Next.js Frontend", "onAutoForward": "openBrowser" },
    "5000": { "label": "Primary Python API" },
    "5050": { "label": "Secondary Python Service" },
    "6380": { "label": "Redis Cache (Custom Port)", "onAutoForward": "notify" }
  }, 
  
  "customizations": {
    "codespaces": {
      "repositories": {
        "ephem24/ai-tutor-module": {
          "permissions": {
            "contents": "write" 
          }
        },
        "ephem24/app-prototype": {
          "permissions": {
            "contents": "write"
          }
        }
      }
    }
  }
}
