{
  "name": "Next.js & Python Full-Stack Codespace",
  "image": "mcr.microsoft.com/devcontainers/universal:latest",
  
  "containerEnv": {
    // This is crucial: make sure the GITHUB_TOKEN is available
    "GITHUB_TOKEN": "${localEnv:GITHUB_TOKEN}"
  },

  // NEW COMMAND: 
  // 1. Install dependencies
  // 2. Configure Git globally to use the GITHUB_TOKEN for ALL HTTPS traffic to GitHub
  // 3. Execute the submodule update (which now has valid credentials)
  "postCreateCommand": "npm install && git config --global url.\"https://x-access-token:${GITHUB_TOKEN}@github.com\".insteadOf \"https://github.com\" && git submodule init && git submodule update", 
  
  "forwardPorts": [3000, 5000, 5050, 6380], 
  "portsAttributes": {
    "3000": { "label": "Next.js Frontend", "onAutoForward": "openBrowser" },
    "5000": { "label": "Primary Python API" },
    "5050": { "label": "Secondary Python Service" },
    "6380": { "label": "Redis Cache (Custom Port)", "onAutoForward": "notify" }
  }, 
  
  "customizations": {
    "vscode": {
      "settings": {
        // Crucial setting to ensure Git uses the credential manager (GitHub token)
        "git.credentialHelper": "manager" 
      }
    },
    "codespaces": {
      "repositories": {
        "ephem24/ai-tutor-module": {
          "permissions": {
            "contents": "write" 
          }
        },
        "ephem24/app-prototype": {
          "permissions": {
            "contents": "write"
          }
        }
      }
    }
  }
}
